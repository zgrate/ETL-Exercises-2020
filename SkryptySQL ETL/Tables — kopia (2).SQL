--AutoGenerated with SQL ManagmentStudio
--DimAccidentReason

CREATE TABLE [dbo].[DimAccidentReason](
	[TowingArticulation] [int] NOT NULL,
	[HitObjectInCarriageway] [int] NOT NULL,
	[AccidentReasonKey] [bigint] IDENTITY(1,1) NOT NULL,
	[JunctionLocation] [int] NOT NULL,
	[VehicleLeavingCarriageway] [int] NOT NULL,
	[SkiddingOverturning] [int] NOT NULL,
	[PointOfImpact] [int] NOT NULL,
	[HitObjectOffCarriageway] [int] NOT NULL,
	[VehicleManoeuvre] [int] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[AccidentReasonKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

--DimDriverDetails

CREATE TABLE [dbo].[DimDriverDetails](
	[JourneyPurpose] [int] NOT NULL,
	[Gender] [int] NOT NULL,
	[DriverDetailsKey] [bigint] IDENTITY(1,1) NOT NULL,
	[Age] [int] NOT NULL,
 CONSTRAINT [PK_DimDriverDetails] PRIMARY KEY CLUSTERED 
(
	[DriverDetailsKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

--DIMVEHICLES
CREATE TABLE [dbo].[DimVehicle](
	[Type] [int] NOT NULL,
	[VehicleIndex] [int] NOT NULL,
	[AccidentReasonKey] [bigint] NOT NULL,
	[EngineCapacity] [int] NOT NULL,
	[VehicleKey] [bigint] NOT NULL,
	[VehicleAge] [int] NOT NULL,
	[SteeringWheelSide] [int] NOT NULL,
	[DriverDetailsKey] [bigint] IDENTITY(1,1) NOT NULL,
 CONSTRAINT [PK_DimVehicle] PRIMARY KEY CLUSTERED 
(
	[VehicleKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[DimVehicle] ADD  CONSTRAINT [FK_DimVehicle_DimAccidentReason] FOREIGN KEY([AccidentReasonKey])
REFERENCES [dbo].[DimAccidentReason] ([AccidentReasonKey])

ALTER TABLE [dbo].[DimVehicle]  ADD  CONSTRAINT [FK_DimVehicle_DimDriverDetails] FOREIGN KEY([DriverDetailsKey])
REFERENCES [dbo].[DimDriverDetails] ([DriverDetailsKey])


--DIMCasuality
CREATE TABLE [dbo].[DimCasuality](
	[AgeOfCasuality] [int] NOT NULL,
	[CasualityIndex] [int] NOT NULL,
	[CasualitySeverity] [int] NOT NULL,
	[CasualityClass] [int] NOT NULL,
	[CasualityType] [int] NOT NULL,
	[CasualityKey] [bigint] IDENTITY(1,1) NOT NULL,
	[BusPassenger] [int] NOT NULL,
	[Gender] [int] NOT NULL,
	[CarPassenger] [int] NOT NULL,
 CONSTRAINT [PK_DimCasuality] PRIMARY KEY CLUSTERED 
(
	[CasualityKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


--DIM_ROAD_CONDITION
CREATE TABLE [dbo].[DimRoadCondition](
	[RoadSurfaceKey] [bigint] IDENTITY(1,1) NOT NULL,
	[UrbanRuralArea] [int] NOT NULL,
	[SpeedLimit] [int] NOT NULL,
	[WeatherCondition] [int] NOT NULL,
	[RoadSurfaceCondition] [int] NOT NULL,
	[SpecialConditionAtSite] [int] NOT NULL,
	[SecondRoadClass] [int] NOT NULL,
	[RoadType] [int] NOT NULL,
	[FirstRoadClass] [int] NOT NULL,
	[LightCondition] [int] NOT NULL,
 CONSTRAINT [PK_DimRoadCondition] PRIMARY KEY CLUSTERED 
(
	[RoadSurfaceKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

--Dim Date
CREATE TABLE [dbo].[DimDate](
	[PK_Date] [datetime] NOT NULL,
	[Year] [int] NULL,
	[Half_Year] [int] NULL,
	[Month_Name] [nvarchar](50) NULL,
	[Day_Of_Year] [int] NULL,
	[Month_Of_Year] [int] NULL,
	[Quarter_Of_Year] [int] NULL,
 CONSTRAINT [PK_Time] PRIMARY KEY CLUSTERED 
(
	[PK_Date] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


--DimTime
CREATE TABLE [dbo].[DimTime](
	[Minute] [bigint] NOT NULL,
	[TimeKey] [varchar](5) NOT NULL,
	[Hour] [bigint] NOT NULL,
	[AM/PM] [varchar](2) NOT NULL,
	[PartOfTheDay] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_DimTime] PRIMARY KEY CLUSTERED 
(
	[TimeKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


--FACT ACCIDENT
CREATE TABLE [dbo].[FactAccident](
	[AccidentSeverity] [int] NOT NULL,
	[TimeKey] [varchar](5) NULL,
	[DateKey] [datetime] NOT NULL,
	[RoadSurfaceKey] [bigint] NOT NULL,
	[AccidentIndex] [varchar](100) NOT NULL,
	[CasualitiesNumber] [int] DEFAULT -1 NOT NULL,
	[VehiclesNumber] [int] DEFAULT -1 NOT NULL
 CONSTRAINT [PK__FactAcci__C031595BD633AA97] PRIMARY KEY CLUSTERED 
(
	[AccidentIndex] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


ALTER TABLE [dbo].[FactAccident]  ADD  CONSTRAINT [FK_FactAccident_DimDate] FOREIGN KEY([DateKey])
REFERENCES [dbo].[DimDate] ([PK_Date])

ALTER TABLE [dbo].[FactAccident] ADD  CONSTRAINT [FK_FactAccident_DimRoadCondition] FOREIGN KEY([RoadSurfaceKey])
REFERENCES [dbo].[DimRoadCondition] ([RoadSurfaceKey])

ALTER TABLE [dbo].[FactAccident] ADD CONSTRAINT [FK_FactAccident_DimTime] FOREIGN KEY([TimeKey])
REFERENCES [dbo].[DimTime] ([TimeKey])

ALTER TABLE [dbo].[FactAccident] NOCHECK CONSTRAINT [FK_FactAccident_DimTime]; 


--Fact Casuality in an accident

CREATE TABLE [dbo].[FactCasualityInAccident](
	[CasualityInAccidentKey] [bigint] IDENTITY(1,1) NOT NULL,
	[AccidentIndex] [varchar](100) NOT NULL,
	[CasualityKey] [bigint] NOT NULL,
 CONSTRAINT [PK__FactCasu__B72C9F7A65F18826] PRIMARY KEY CLUSTERED 
(
	[CasualityInAccidentKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[FactCasualityInAccident] ADD  CONSTRAINT [FK_FactCasualityInAccident_DimCasuality] FOREIGN KEY([CasualityKey])
REFERENCES [dbo].[DimCasuality] ([CasualityKey])

ALTER TABLE [dbo].[FactCasualityInAccident] ADD  CONSTRAINT [FK_FactCasualityInAccident_DimCasuality1] FOREIGN KEY([CasualityKey])
REFERENCES [dbo].[DimCasuality] ([CasualityKey])

ALTER TABLE [dbo].[FactCasualityInAccident] ADD  CONSTRAINT [FK_FactCasualityInAccident_FactAccident] FOREIGN KEY([AccidentIndex])
REFERENCES [dbo].[FactAccident] ([AccidentIndex])


--Fact vehicle in an accident
CREATE TABLE [dbo].[FactVehicleInAccident](
	[VehicleInAccidentKey] [bigint] IDENTITY(1,1) NOT NULL,
	[AccidentIndex] [varchar](100) NOT NULL,
	[VehicleKey] [bigint] NOT NULL,
 CONSTRAINT [PK__FactVehi__4AEDAC8B1DE50B91] PRIMARY KEY CLUSTERED 
(
	[VehicleInAccidentKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[FactVehicleInAccident] ADD  CONSTRAINT [FK_FactVehicleInAccident_DimVehicle] FOREIGN KEY([VehicleKey])
REFERENCES [dbo].[DimVehicle] ([VehicleKey])

ALTER TABLE [dbo].[FactVehicleInAccident]  ADD  CONSTRAINT [FK_FactVehicleInAccident_FactAccident] FOREIGN KEY([AccidentIndex])
REFERENCES [dbo].[FactAccident] ([AccidentIndex])








