--AutoGenerated with SQL ManagmentStudio
--DimAccidentReason

CREATE TABLE [dbo].[DimCrashDetails](
	[TowingArticulation] [nvarchar](100) NOT NULL,
	[HitObjectInCarriageway] [nvarchar](100) NOT NULL,
	[CrashDetailsKey] [bigint] IDENTITY(1,1) NOT NULL,
	[JunctionLocation] [nvarchar](100) NOT NULL,
	[VehicleLeavingCarriageway] [nvarchar](100) NOT NULL,
	[SkiddingOverturning] [nvarchar](100) NOT NULL,
	[PointOfImpact] [nvarchar](100) NOT NULL,
	[HitObjectOffCarriageway] [nvarchar](100) NOT NULL,
	[VehicleManoeuvre] [nvarchar](100) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[CrashDetailsKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

--DimDriverDetails

CREATE TABLE [dbo].[DimDriverDetails](
	[DriverJourneyPurpose] [nvarchar](100) NOT NULL,
	[DriverGender] [nvarchar](100) NOT NULL,
	[DriverDetailsKey] [bigint] IDENTITY(1,1) NOT NULL,
	[DriverAgeBand] [nvarchar](100) NOT NULL,
 CONSTRAINT [PK_DimDriverDetails] PRIMARY KEY CLUSTERED 
(
	[DriverDetailsKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

--DIMVEHICLES
CREATE TABLE [dbo].[DimVehicle](
	[Type] [nvarchar](100) NOT NULL,
	[VehicleIndex] [int] NOT NULL,
	[CrashDetailsKey] [bigint] NOT NULL,
	[EngineCapacity] [nvarchar](100) NOT NULL,
	[VehicleKey] [bigint] IDENTITY(1,1) NOT NULL,
	[VehicleAge] [int] NOT NULL,
	[SteeringWheelSide] [nvarchar](100) NOT NULL,
	[DriverDetailsKey] [bigint] NOT NULL,
 CONSTRAINT [PK_DimVehicle] PRIMARY KEY CLUSTERED 
(
	[VehicleKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[DimVehicle] ADD  CONSTRAINT [FK_DimVehicle_DimCrashDetails] FOREIGN KEY([CrashDetailsKey])
REFERENCES [dbo].[DimCrashDetails] ([CrashDetailsKey])

ALTER TABLE [dbo].[DimVehicle]  ADD  CONSTRAINT [FK_DimVehicle_DimDriverDetails] FOREIGN KEY([DriverDetailsKey])
REFERENCES [dbo].[DimDriverDetails] ([DriverDetailsKey])


--DIMCasualty
CREATE TABLE [dbo].[DimCasualty](
	[AgeBandOfCasualty] [nvarchar](100) NOT NULL,
	[CasualtyIndex] [int] NOT NULL,
	[CasualtySeverity] [nvarchar](100) NOT NULL,
	[CasualtyClass] [nvarchar](100) NOT NULL,
	[CasualtyType] [nvarchar](100) NOT NULL,
	[CasualtyKey] [bigint] IDENTITY(1,1) NOT NULL,
	[BusPassenger] [nvarchar](100) NOT NULL,
	[Gender] [nvarchar](100) NOT NULL,
	[CarPassenger] [nvarchar](100) NOT NULL,
 CONSTRAINT [PK_DimCasualty] PRIMARY KEY CLUSTERED 
(
	[CasualtyKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


--DIM_ROAD_CONDITION
CREATE TABLE [dbo].[DimRoadCondition](
	[RoadSurfaceKey] [bigint] IDENTITY(1,1) NOT NULL,
	[UrbanRuralArea] [nvarchar](100) NOT NULL,
	[SpeedLimit] [nvarchar](100) NOT NULL,
	[WeatherCondition] [nvarchar](100) NOT NULL,
	[RoadSurfaceCondition] [nvarchar](100) NOT NULL,
	[SpecialConditionAtSite] [nvarchar](100) NOT NULL,
	[SecondRoadClass] [nvarchar](100) NOT NULL,
	[RoadType] [nvarchar](100) NOT NULL,
	[FirstRoadClass] [nvarchar](100) NOT NULL,
	[LightCondition] [nvarchar](100) NOT NULL,
 CONSTRAINT [PK_DimRoadCondition] PRIMARY KEY CLUSTERED 
(
	[RoadSurfaceKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

--Dim Date
CREATE TABLE [dbo].[DimDate](
	[PK_Date] [datetime] NOT NULL,
	[Year] [int] NULL,
	[Half_Year] [int] NULL,
	[Month_Name] [nvarchar](50) NULL,
	[Day_Of_Year] [int] NULL,
	[Month_Of_Year] [int] NULL,
	[Quarter_Of_Year] [int] NULL,
 CONSTRAINT [PK_Time] PRIMARY KEY CLUSTERED 
(
	[PK_Date] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


--DimTime
CREATE TABLE [dbo].[DimTime](
	[Minute] [bigint] NOT NULL,
	[TimeKey] [nvarchar](5) NOT NULL,
	[Hour] [bigint] NOT NULL,
	[AM/PM] [nvarchar](2) NOT NULL,
	[PartOfTheDay] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_DimTime] PRIMARY KEY CLUSTERED 
(
	[TimeKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


--FACT ACCIDENT
CREATE TABLE [dbo].[FactAccident](
	[TimeKey] [nvarchar](5) NOT NULL,
	[DateKey] [datetime] NOT NULL,
	[RoadSurfaceKey] [bigint] NOT NULL,
	[AccidentIndex] [nvarchar](100) NOT NULL,
	[SevereCasualties] [int] DEFAULT -1 NOT NULL,
	[FatalCasualties] [int] DEFAULT -1 NOT NULL,
	[LightCasualties] [int] DEFAULT -1 NOT NULL,
	[VehiclesNumber] [int] DEFAULT -1 NOT NULL
 CONSTRAINT [PK__FactAcci__C031595BD633AA97] PRIMARY KEY CLUSTERED 
(
	[AccidentIndex] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]


ALTER TABLE [dbo].[FactAccident]  ADD  CONSTRAINT [FK_FactAccident_DimDate] FOREIGN KEY([DateKey])
REFERENCES [dbo].[DimDate] ([PK_Date])

ALTER TABLE [dbo].[FactAccident] ADD  CONSTRAINT [FK_FactAccident_DimRoadCondition] FOREIGN KEY([RoadSurfaceKey])
REFERENCES [dbo].[DimRoadCondition] ([RoadSurfaceKey])

ALTER TABLE [dbo].[FactAccident] ADD CONSTRAINT [FK_FactAccident_DimTime] FOREIGN KEY([TimeKey])
REFERENCES [dbo].[DimTime] ([TimeKey])

ALTER TABLE [dbo].[FactAccident] NOCHECK CONSTRAINT [FK_FactAccident_DimTime]; 


--Fact Casualty in an accident

CREATE TABLE [dbo].[FactCasualtyInAccident](
	[AccidentIndex] [nvarchar](100) NOT NULL,
	[CasualtyKey] [bigint] NOT NULL,
 CONSTRAINT [PK_FactCasualtyInAccident] PRIMARY KEY CLUSTERED 
(
	[AccidentIndex] ASC,
	[CasualtyKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[FactCasualtyInAccident] ADD  CONSTRAINT [FK_FactCasualtyInAccident_DimCasualty] FOREIGN KEY([CasualtyKey])
REFERENCES [dbo].[DimCasualty] ([CasualtyKey])

ALTER TABLE [dbo].[FactCasualtyInAccident] ADD  CONSTRAINT [FK_FactCasualtyInAccident_FactAccident] FOREIGN KEY([AccidentIndex])
REFERENCES [dbo].[FactAccident] ([AccidentIndex])


--Fact vehicle in an accident
CREATE TABLE [dbo].[FactVehicleInAccident](
	[AccidentIndex] [nvarchar](100) NOT NULL,
	[VehicleKey] [bigint] NOT NULL,
 CONSTRAINT [PK_FactVehicleInAccident] PRIMARY KEY CLUSTERED 
(
	[AccidentIndex] ASC,
	[VehicleKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[FactVehicleInAccident] ADD  CONSTRAINT [FK_FactVehicleInAccident_DimVehicle] FOREIGN KEY([VehicleKey])
REFERENCES [dbo].[DimVehicle] ([VehicleKey])

ALTER TABLE [dbo].[FactVehicleInAccident]  ADD  CONSTRAINT [FK_FactVehicleInAccident_FactAccident] FOREIGN KEY([AccidentIndex])
REFERENCES [dbo].[FactAccident] ([AccidentIndex])


CREATE TABLE [dbo].[AttributesLookup](
	[AllowedAttribute] [nvarchar](50) NOT NULL,
 CONSTRAINT [PK_AttributesLookup] PRIMARY KEY CLUSTERED 
(
	[AllowedAttribute] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

INSERT INTO [dbo].[AttributesLookup]
           ([AllowedAttribute])
     VALUES
           ('AgeBand'), ('BusPassenger'), ('CarPassenger'), ('CasualtyClass'),('CasualtyType'),
		  ('Gender'),('HitObjectInCarriageway'),('HitObjectOffCarriageway'),('JourneyPurpose'),
		  ('JunctionLocation'),('LightCondition'),('PointOfImpact'),('RoadClass'),('RoadSurfaceCondition'),
		  ('RoadType'),('Severity'),('SkiddingOverturning'),('SpecialConditionAtSite'),('SteeringWheelSide'),
		  ('TowingArticulation'),('UrbanRuralArea'),('VehicleLeavingCarriageway'),('VehicleManoeuvre'),
		  ('VehicleType'),('WeatherCondition')

CREATE TABLE [dbo].[LookupTable](
	[LookupType] [nvarchar](50) NOT NULL,
	[LookupValue] [nvarchar](100) NULL,
	[LookupName] [nvarchar](100) NOT NULL,
	[LookupID] [bigint] IDENTITY(1,1) NOT NULL,
 CONSTRAINT [PK_LookupTable] PRIMARY KEY CLUSTERED 
(
	[LookupID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
